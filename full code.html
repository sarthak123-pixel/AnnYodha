<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnnYodha - FoodSaver</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
html, body { margin:0; padding:0; height:100%; font-family:'Segoe UI',sans-serif; overflow:hidden; color:white; cursor:pointer; }
body { background:black; }
.gradient-bg { background: linear-gradient(-45deg, #3498db, #2ecc71, #2980b9, #27ae60); background-size: 400% 400%; animation: gradientMove 20s ease infinite; }
@keyframes gradientMove { 0% {background-position:0% 50%;} 50% {background-position:100% 50%;} 100% {background-position:0% 50%;} }
.ripple { position:absolute; border-radius:50%; background:rgba(255,255,255,0.5); transform:scale(0); animation:rippleEffect 0.6s ease-out forwards; pointer-events:none; }
@keyframes rippleEffect { to { transform: scale(4); opacity:0; } }
nav { position:fixed; top:20px; left:20px; display:flex; gap:20px; z-index:1000; display:none; }
nav a { color:white; text-decoration:none; font-weight:bold; font-size:1rem; transition:0.3s; padding:6px 12px; border-radius:6px; }
nav a:hover { background:#3498db; }
section { position:absolute; top:0; left:0; width:100%; height:100%; padding:50px 20px; text-align:center; opacity:0; pointer-events:none; transition:opacity 0.8s ease; background-size:cover; background-position:center; overflow:auto; }
section.active { opacity:1; pointer-events:auto; }
.btn { padding:15px 30px; font-size:1.2rem; border:none; border-radius:25px; background:white; color:#2980b9; cursor:pointer; font-weight:bold; transition:0.3s; }
.btn:hover { background:#3498db; color:white; box-shadow:0 0 15px rgba(0,0,0,0.5); }
form { display:inline-block; margin-top:50px; padding:25px; background:rgba(0,0,0,0.7); border-radius:12px; max-width:500px; color:white; text-align:left; box-shadow:0 8px 16px rgba(0,0,0,0.5); }
form h2 { text-align:center; margin-bottom:20px; color:#3498db; }
form input, form select, form button { width:100%; margin:10px 0; padding:12px; border-radius:6px; border:none; font-size:1rem; }
form input, form select { background:#222; color:white; border:1px solid #555; }
form button { background:#3498db; color:white; cursor:pointer; transition:0.3s; }
form button:hover { background:#2980b9; }
footer { position:fixed; bottom:20px; right:20px; display:flex; gap:15px; }
footer a { color:white; text-decoration:none; font-weight:bold; transition:0.3s; }
footer a:hover { color:#3498db; }
@media(max-width:600px){ nav { flex-direction:column; top:10px; left:10px; gap:10px; } form { width:90%; margin-top:120px; } }
#map { width:100%; height:400px; border-radius:12px; margin-top:20px; }
#chatBot { position:fixed; bottom:20px; right:20px; width:300px; max-height:400px; background:rgba(0,0,0,0.9); border-radius:12px; display:flex; flex-direction:column; overflow:hidden; box-shadow:0 8px 16px rgba(0,0,0,0.5); display:none; z-index:2000; }
#chatHeader { background:#3498db; padding:10px; font-weight:bold; cursor:pointer; }
#chatMessages { flex:1; padding:10px; overflow-y:auto; color:white; font-size:0.9rem; }
#chatInput { display:flex; border-top:1px solid #555; }
#chatInput input { flex:1; border:none; padding:10px; background:#222; color:white; border-radius:0; }
#chatInput button { padding:10px; background:#3498db; color:white; border:none; cursor:pointer; }
#chatInput button:hover { background:#2980b9; }
.message { margin:5px 0; padding:6px 10px; border-radius:10px; max-width:80%; }
.userMsg { background:#3498db; align-self:flex-end; }
.botMsg { background:#2ecc71; align-self:flex-start; }
</style>
</head>
<body class="gradient-bg">

<!-- Welcome -->
<section id="welcome" class="active" style="background-image:url('help.png'); background-size:cover; background-position:center;">
  <h1>Welcome to AnnYodha</h1>
  <p>Connecting Donors with NGOs â€” Together for a Better Tomorrow ðŸŒŠ</p>
  <button id="getStarted" class="btn">Get Started</button>
</section>

<!-- Navigation -->
<nav id="mainNav">
  <a href="#" data-target="home">Home</a>
  <a href="#" data-target="aboutUs" id="aboutUsLink" style="display:none;">About Us</a>
  <a href="#" data-target="donateForm">Donate Now</a>
  <a href="#" data-target="ngoForm">Register NGO</a>
  <a href="#" onclick="toggleChat()">Need Help?</a>
</nav>

<!-- Home -->
<section id="home" style="background-image:url('help.png');">
  <h2>Welcome to AnnYodha</h2>
</section>

<!-- About Us -->
<section id="aboutUs" style="background-image:url('help.png'); text-align:left;">
  <h2>About Us</h2>
  <p>AnnYodha bridges the gap between surplus food and people in need. We partner with hotels, restaurants, and individuals to efficiently deliver food to hungry communities.</p>
  <p><strong>Our Mission:</strong> Reduce food waste, improve accessibility, and create sustainable relationships between donors and NGOs.</p>
  <p><strong>How We Work:</strong> Donors submit food donations specifying type, quantity, and message. NGOs receive alerts about nearby donations. Volunteers assist in reaching remote communities.</p>
  <p><strong>Our Impact:</strong> Thousands of meals served every month, reducing waste and feeding the needy. Every contribution counts toward a healthier, more compassionate society.</p>
</section>

<!-- Donate Form -->
<section id="donateForm" style="background-image:url('help.png');">
  <form id="donateFormActual">
    <h2>Food Donation</h2>
    <input type="text" name="donor_name" placeholder="Your Name / Hotel Name" required>
    <input type="email" name="donor_email" placeholder="Your Email" required>
    <input type="text" name="donor_address" id="donorAddress" placeholder="Click on map to select address" readonly required>
    <button type="button" class="btn" onclick="showMap('donor')">Select Address on Map</button>
    <input type="tel" name="donor_phone" placeholder="Phone" required>
    <input type="number" name="donor_foodamount" placeholder="Amount of Food" required>
    <select name="donor_foodtype" required>
      <option value="">Select Food Type</option>
      <option value="Veg">Veg</option>
      <option value="Non-Veg">Non-Veg</option>
    </select>
    <input type="text" name="donor_message" placeholder="Message to nearby NGOs">
    <input type="hidden" name="donor_lat" id="donor_lat">
    <input type="hidden" name="donor_lng" id="donor_lng">
    <button type="submit">Submit Donation</button>
  </form>
</section>

<!-- NGO Form -->
<section id="ngoForm" style="background-image:url('help.png');">
  <form id="ngoFormActual">
    <h2>NGO Registration</h2>
    <input type="text" name="ngo_name" placeholder="NGO Name" required>
    <input type="email" name="ngo_email" placeholder="Email" required>
    <input type="text" name="ngo_address" id="ngoAddress" placeholder="Click on map to select address" readonly required>
    <button type="button" class="btn" onclick="showMap('ngo')">Select Address on Map</button>
    <input type="tel" name="ngo_phone" placeholder="Phone" required>
    <input type="number" name="ngo_capacity" placeholder="Food Collection Capacity" required>
    <input type="hidden" name="ngo_lat" id="ngo_lat">
    <input type="hidden" name="ngo_lng" id="ngo_lng">
    <button type="submit">Register NGO</button>
  </form>
</section>

<!-- Map Section -->
<section id="mapSection" style="background:black;">
  <h2>Select Address</h2>
  <div id="map"></div>
  <button class="btn" onclick="doneMap()">Done</button>
</section>

<!-- Thank You -->
<section id="thankyou" style="background-image:url('help.png');">
  <h2>Thank You!</h2>
  <p>Your submission has been received successfully.</p>
  <button class="btn" onclick="showSection('home')">Go to Home</button>
</section>

<!-- ChatBot -->
<div id="chatBot">
  <div id="chatHeader" onclick="toggleChat()">Need Help? (Click to Close)</div>
  <div id="chatMessages"></div>
  <div id="chatInput">
    <input type="text" id="userInput" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<footer>
  <a href="mailto:orewasarthak0302@gmail.com">Contact Us</a>
  <a href="#" id="jobsLink" style="display:none;">Jobs</a>
</footer>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAG9AjCGuNewHyUy2cAudm097mg4ilRbe8",
  authDomain: "annyodha-550a9.firebaseapp.com",
  projectId: "annyodha-550a9",
  storageBucket: "annyodha-550a9.firebasestorage.app",
  messagingSenderId: "200833826425",
  appId: "1:200833826425:web:6e088dcea3566a879b1ea8",
  measurementId: "G-FGQGCKD4KB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Ripple effect
document.body.addEventListener('click', function(e){
  const ripple = document.createElement('span');
  ripple.classList.add('ripple');
  ripple.style.left = `${e.clientX}px`;
  ripple.style.top = `${e.clientY}px`;
  ripple.style.width = ripple.style.height = '20px';
  document.body.appendChild(ripple);
  ripple.addEventListener('animationend', () => ripple.remove());
});

// Sections
const sections = document.querySelectorAll('section');
const mainNav = document.getElementById('mainNav');
let currentFormField = '';
function showSection(id){
  sections.forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Get Started
document.getElementById('getStarted').addEventListener('click', ()=>{
  mainNav.style.display='flex';
  showSection('home');
  document.getElementById('aboutUsLink').style.display='inline';
  document.getElementById('jobsLink').style.display='inline';
});

// Map
let map, marker;
function showMap(field){
  currentFormField = field;
  showSection('mapSection');
  if(!map){
    map = L.map('map').setView([28.6139,77.2090], 12); // Default Delhi
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    marker = L.marker([28.6139,77.2090], {draggable:true}).addTo(map);
    marker.on('dragend', function(e){ updateLatLng(currentFormField,e.target.getLatLng()); });
    map.on('click', function(e){ marker.setLatLng(e.latlng); updateLatLng(currentFormField,e.latlng); });
  }
}

function updateLatLng(field, latlng){
  if(field==='donor'){
    document.getElementById('donorAddress').value='Lat:'+latlng.lat.toFixed(5)+' Lng:'+latlng.lng.toFixed(5);
    document.getElementById('donor_lat').value=latlng.lat;
    document.getElementById('donor_lng').value=latlng.lng;
  } else {
    document.getElementById('ngoAddress').value='Lat:'+latlng.lat.toFixed(5)+' Lng:'+latlng.lng.toFixed(5);
    document.getElementById('ngo_lat').value=latlng.lat;
    document.getElementById('ngo_lng').value=latlng.lng;
  }
}

function doneMap(){ showSection(currentFormField==='donor'?'donateForm':'ngoForm'); }

// --- Donor Submit ---
document.getElementById('donateFormActual').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  try{
    const donorRef = await addDoc(collection(db,'donations'),{
      name:f.donor_name.value,
      email:f.donor_email.value,
      address:f.donor_address.value,
      phone:f.donor_phone.value,
      foodType:f.donor_foodtype.value,
      amount:Number(f.donor_foodamount.value),
      message:f.donor_message.value,
      lat:Number(f.donor_lat.value),
      lng:Number(f.donor_lng.value),
      timestamp:serverTimestamp()
    });

    // Notify nearest 5â€“7 NGOs
    const ngoSnap = await getDocs(collection(db,'ngos'));
    let ngos = [];
    ngoSnap.forEach(doc=>{
      const data = doc.data();
      const distance = getDistance(Number(f.donor_lat.value), Number(f.donor_lng.value), data.lat, data.lng);
      ngos.push({...data, distance});
    });
    ngos.sort((a,b)=>a.distance - b.distance);
    const nearestNGOs = ngos.slice(0,7);
    for(const ngo of nearestNGOs){
      await addDoc(collection(db,'notifications'),{
        ngoEmail: ngo.email,
        donorName: f.donor_name.value,
        donorMessage: f.donor_message.value,
        donorAddress: f.donor_address.value,
        donorFoodType: f.donor_foodtype.value,
        donorAmount: Number(f.donor_foodamount.value),
        timestamp: serverTimestamp()
      });
    }

    alert('Donation submitted!');
    f.reset();
    showSection('thankyou');
  }catch(err){ alert('Error: '+err); }
});

// --- NGO Submit ---
document.getElementById('ngoFormActual').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  try{
    await addDoc(collection(db,'ngos'),{
      name:f.ngo_name.value,
      email:f.ngo_email.value,
      address:f.ngo_address.value,
      phone:f.ngo_phone.value,
      capacity:Number(f.ngo_capacity.value),
      lat:Number(f.ngo_lat.value),
      lng:Number(f.ngo_lng.value),
      timestamp:serverTimestamp()
    });
    alert('NGO Registered!');
    f.reset();
    showSection('thankyou');
  }catch(err){ alert('Error: '+err); }
});

// --- Helper: Haversine distance in km ---
function getDistance(lat1, lng1, lat2, lng2){
  const R = 6371;
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLng = (lng2-lng1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
  const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R*c;
}

// --- ChatBot ---
function toggleChat(){
  const chat = document.getElementById('chatBot');
  chat.style.display = chat.style.display==='flex'?'none':'flex';
}
function sendMessage(){
  const input = document.getElementById('userInput');
  const msg = input.value.trim();
  if(!msg) return;
  addMessage(msg,'userMsg');
  input.value='';
  setTimeout(()=>botReply(msg),500);
}
function addMessage(msg,type){
  const chatMessages = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className=`message ${type}`;
  div.textContent=msg;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function botReply(msg){
  msg=msg.toLowerCase();
  let reply="Sorry, I didn't understand that. Try asking about donating or getting food.";
  if(msg.includes('donate')) reply="To donate food, please go to 'Donate Now' form.";
  else if(msg.includes('food') || msg.includes('help')) reply="If you need food, please share your location on the map and contact a nearby NGO.";
  else if(msg.includes('ngo')) reply="To register an NGO, use the 'Register NGO' form.";
  addMessage(reply,'botMsg');
}

// Navigation
document.querySelectorAll('nav a').forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    const target = link.getAttribute('data-target');
    showSection(target);
  });
});
</script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>
</html>
